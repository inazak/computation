# logicgate

extremely small logic blocks of computer architecture

## 概要

コンピュータアーキテクチャの基本となるパーツを全部 NAND から組み立てたい。
でも電気にかかわる細かい部分は無視して、論理的な構造だけ考えたい。
そのために、NAND というパーツを組み合わせて、指定した場所の状態を
クロック毎に出力する、ということだけのスクリプト実行環境を作る。

ということで、ここには論理的な NAND しかない。


## 1. スクリプトの書式

コメントの書式以外は、予約語の後にポート番号を指定する。
ポート番号の数字列は `0` から `9` までの文字を使った
ものであればなんでもいい。予約されている番号もない。

| 動作 | 書式 | 補足 |
| ---- | ---- | ---- |
| NANDを追加 | `NAND input1 input2 output` | ※1 |
| ポートとポートを接続 | `CONNECT from to` | ※2 |
| 常に`0`を返すポートを定義 | `LO output` | ※1 |
| 常に`1`を返すポートを定義 | `HI output` | ※1 |
| クロックを返すポートを定義 | `CLOCK output` | ※1 |
| 結果をモニタするポートを定義 | `LED input` | ※1 |
| コメントを追加 | `// this is comment` |  |

| 補足 | 説明 |
| ---- | ---- |
| ※1 | ポート番号は既存のものと重複しないこと |
| ※2 | 少なくともどちらかのポート番号は既存のものであること |


## 2. 単純な例

次の図の構成を例にする。

![](https://raw.githubusercontent.com/inazak/computation/master/logicgate/v02/logicgate/_misc/01-01.png)

図の要素の説明は、次の通り。

- 図にある数字列は各要素をつないでいる端子（ポート）。
- `LO` は、常に `0` の信号を送り出す。
- `HI` は、常に `1` の信号を送り出す。
- `LED` は、受け取った信号を画面に表示する。

なのでこの図の通りであれば、`NAND(0,1) => 1` の値を、LEDが表示することになる。

これを次のように記述する。

```
LO 1000
HI 1001
LED 3000
NAND 0001 0002 0003
CONNECT 1000 0001
CONNECT 1001 0002
CONNECT 0003 3000
```

テキストファイル `02.txt` に保存して実行してみる。
止まらないので、途中で `Ctrl+C` で止める。

```
$ logicgate.exe 02.txt
000000: 3000=[1]
----
000001: 3000=[1]
----
000002: 3000=[1]
----
```

左端に表示されている `000000:` とか `000001:` とか `000002:` とかは
クロックの経過を表している。何も指定しないと、1秒間に1クロック刻む。

右側の `3000=[1]` が結果。`3000` が先程の LED のポート番号で、`[x]` の中がその値。
期待通りに `1` が返ってきている。

`CONNECT` 以外はどれも、新規のポート番号を指定する必要があるので、
下記のような指定は出来ない。

```
// NG !!
LO 1000
HI 1001
LED 3000
NAND 1000 1001 3000
```


## 3. XOR

図にすると次の通り。

![](https://raw.githubusercontent.com/inazak/computation/master/logicgate/v02/logicgate/_misc/02-01.png)

スクリプトにすると次の通り。

```
HI 1111
HI 2222
LED 3333
CONNECT 0012 3333
NAND 0001 0002 0003
CONNECT 1111 0001
CONNECT 2222 0002
NAND 0004 0005 0006
CONNECT 1111 0004
CONNECT 0003 0005
NAND 0007 0008 0009
CONNECT 2222 0007
CONNECT 0003 0008
NAND 0010 0011 0012
CONNECT 0006 0010
CONNECT 0009 0011
```

結果は次の通り。

```
$ logicgate.exe 03.txt
000000: 3333=[0]
----
000001: 3333=[0]
----
000002: 3333=[0]
----
```

想定通りに `XOR(1,1) => 0` になっている。ポート番号の `1111` と `2222` を
`LO` と `HI` で四通り確認してみると、XORの結果になっていることが分かる。



## 4. ラッチ

図にすると次の通り。

![](https://raw.githubusercontent.com/inazak/computation/master/logicgate/v02/logicgate/_misc/04-01.png)

この構成の入出力は次のようになる。

| Aの入力 | Bの入力 | 出力 |
| ---- | ---- | ---- |
| LO | LO | 使用禁止 |
| LO | HI | HI |
| HI | LO | LO |
| HI | HI | 今のOutputと同じ値 |

使用禁止については、電気的な考慮のないこのシミュレータでは、
期待した動作にならない、ということになる。

スクリプトにすると次の通り。`A` を `LO` で `B` を `HI` としている。

```
LO 0001
HI 0002
LED 0003
NAND 0004 0005 0006
NAND 0007 0008 0009
CONNECT 0001 0004
CONNECT 0002 0007
CONNECT 0006 0008
CONNECT 0009 0005
CONNECT 0006 0003
```

結果は次の通り。

```
$ logicgate.exe 04.txt
000000: 0003=[1]
----
000001: 0003=[1]
----
000002: 0003=[1]
----
```

`A` と `B` を逆にして確認すると、表の通りの結果になることが分かる。

このスクリプトの中ではユーザーが任意のタイミングで値を変更できる
仕掛けがないので、以前の出力を「継続」する例が出せない。


## 終了

実現したかったことが分かりやすい形になっていないため、終了。


